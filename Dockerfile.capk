FROM golang:1.12.5
WORKDIR /cluster-api-upgrade-tool
ADD go.mod .
ADD go.sum .
ADD vendor vendor
ADD cmd cmd
ADD capkactuators capkactuators
ADD pkg/execer pkg/execer
RUN go install -mod=vendor -v ./cmd/capk-manager
RUN GO111MODULE="on" go get sigs.k8s.io/kind@v0.3.0
RUN curl https://get.docker.com | sh

FROM golang:1.12.5
COPY --from=0 /go/bin/capk-manager /usr/local/bin
COPY --from=0 /go/bin/kind /usr/local/bin
COPY --from=0 /usr/bin/docker /usr/local/bin
ENTRYPOINT ["capk-manager"]
